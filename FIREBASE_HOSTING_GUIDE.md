# Firebase Hosting Deployment Guide

## ✅ Prerequisites Completed
- Firebase CLI installed ✓
- Firebase configuration files created ✓
- Project configured with Firebase ✓

## 🔧 Configuration Files Created

### 1. firebase.json
```json
{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [{ "source": "**", "destination": "/index.html" }],
    "headers": [
      {
        "source": "**/*.@(js|jsx|ts|tsx)",
        "headers": [{ "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }]
      }
    ]
  },
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  }
}
```

### 2. firestore.rules
Security rules configured for:
- Public read access to products, articles, brands
- Authenticated user access for leads and requests
- User-specific data protection

### 3. firestore.indexes.json
Database indexes optimized for:
- Product filtering by category and brand
- Price-based sorting
- Lead timestamp ordering

## 🚀 Deployment Steps

### Step 1: Build Your Project
```bash
npm run build
```
This creates the `dist` folder with production-ready files.

### Step 2: Login to Firebase
```bash
npx firebase login
```
This opens your browser for Google authentication.

### Step 3: Initialize Firebase Project
```bash
npx firebase init
```
Select:
- Hosting: Configure files for Firebase Hosting
- Firestore: Set up Firestore security rules and indexes
- Use existing project: `comperra-done`

### Step 4: Deploy to Firebase Hosting
```bash
npx firebase deploy
```

### Step 5: Deploy Firestore Rules & Indexes (Optional)
```bash
npx firebase deploy --only firestore
```

## 🌐 Expected Results

After deployment, your site will be available at:
- **Hosting URL**: `https://comperra-done.web.app`
- **Custom Domain**: `https://comperra-done.firebaseapp.com`

## 🔧 Build Configuration

Your `package.json` already includes the correct build script:
```json
{
  "scripts": {
    "build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist"
  }
}
```

## 📁 Project Structure for Hosting

```
dist/                    # Generated by build (hosting files)
├── index.html          # Main HTML file
├── assets/             # CSS, JS, and other assets
│   ├── index-[hash].js
│   └── index-[hash].css
└── [other static files]

firebase.json           # Firebase configuration
firestore.rules         # Database security rules
firestore.indexes.json  # Database indexes
```

## 🔒 Security Notes

**Firestore Rules Include:**
- Public read access for product catalog
- Authenticated write access for admin operations
- Anonymous lead submission (with rate limiting)
- User-specific data protection

**Hosting Headers:**
- Long-term caching for static assets
- Single Page Application routing
- Security headers for production

## 🎯 Testing Your Deployment

1. **Authentication**: Test Firebase Auth at `/firebase-demo`
2. **Database**: Verify Firestore connections work
3. **Routing**: Check all pages load correctly
4. **Performance**: Confirm caching headers are applied

## 🔧 Troubleshooting

**Build Issues:**
- Clear node_modules: `rm -rf node_modules && npm install`
- Update browsers data: `npx update-browserslist-db@latest`

**Deployment Issues:**
- Check Firebase project permissions
- Verify billing account is set up
- Ensure quota limits aren't exceeded

**Runtime Issues:**
- Check browser console for errors
- Verify Firebase configuration in production
- Test API endpoints are accessible

## 🔄 Continuous Deployment

For future updates:
```bash
npm run build && npx firebase deploy
```

Your Comperra project is now ready for Firebase Hosting! 🎉